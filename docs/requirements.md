# Spec CLI 需求文档

## 1. 项目概述

Spec CLI 是一个命令行工具，用于规范化软件开发流程中的 Feature 管理。它自动化了创建新功能时的文档结构、测试文件和 Git 分支管理，帮助开发者遵循统一的开发规范。

## 2. 目标用户

- **当前阶段**：个人开发者
- **未来阶段**：开发团队

## 3. 核心价值

- 标准化 Feature 开发流程
- 自动化重复性的文件和分支创建工作
- 确保每个 Feature 都有完整的文档和测试结构
- 提高开发效率和代码仓库的组织性

## 4. 使用场景

### 场景 1：开始开发新功能

开发者需要开发一个新功能"用户认证系统"：

1. 运行命令：`spec create "Add user authentication system"`
2. 工具自动完成：
   - 生成规范的 feature 标识符（如：user-authentication）
   - 创建文档目录结构和必要的文档文件
   - 创建对应的测试文件
   - 创建并切换到新的 feature 分支
   - 提交初始化的文件结构
3. 开发者直接开始编写文档和代码

### 场景 2：项目初始化配置

新项目或新成员首次使用工具：

1. 运行 `spec init` 命令
2. 通过交互式向导配置项目规范
3. 生成配置文件，供后续命令使用

### 场景 3：查看现有功能

开发者想了解项目中有哪些正在开发或已开发的功能：

1. 运行 `spec list` 命令
2. 查看所有 feature 的列表

### 场景 4：合并完成的功能

功能开发完成，需要合并回主分支：

1. 运行 `spec merge user-authentication`
2. 工具自动合并到配置的目标分支

## 5. 功能需求

### 5.1 初始化配置 (spec init)

**功能描述**：
通过交互式向导帮助用户配置项目规范，生成配置文件。

**配置项**：
- 文档目录路径（默认：`docs/`）
- 文档模板列表（默认：`requirements.md`, `tech-spec.md`, `user-stories.md`）
- 测试目录路径（自动检测常见路径，用户确认或修改）
- 测试文件扩展名（自动检测项目中使用的扩展名）
- 分支命名格式（默认：`feature-{slug}`）
- 默认合并目标分支（默认：`main`）

**行为要求**：
- 提供清晰的提示和默认值
- 自动检测项目结构，减少用户输入
- 验证配置的有效性
- 生成配置文件供后续使用

### 5.2 创建功能 (spec create)

**命令格式**：
```bash
spec create <description>
```

**功能描述**：
根据用户提供的功能描述，自动创建完整的功能开发结构。

**输入**：
- 功能描述（自然语言，如："Add user authentication system"）

**处理流程**：
1. 调用 LLM 接口，根据描述生成规范的 feature-slug
2. 根据配置文件创建文档目录：`docs/{feature-slug}/`
3. 在文档目录中创建配置的文档文件（空文件或包含基础模板）
4. 如果项目配置了测试目录，创建对应的测试文件
5. 创建并切换到新的 feature 分支（命名遵循配置的格式）
6. 将创建的文件提交到 Git（使用规范的 commit message）

**异常处理**：
- Feature 已存在时，提示用户并终止操作
- LLM 调用失败时，提供错误信息和处理建议
- Git 操作失败时，提供清晰的错误提示

**约束**：
- Feature slug 必须唯一
- 必须在 Git 仓库中执行
- 工作区应该是干净的（无未提交的变更）

### 5.3 列出功能 (spec list)

**命令格式**：
```bash
spec list
```

**功能描述**：
列出所有已创建的 feature。

**输出内容**：
- Feature slug 列表

**识别规则**：
- 基于文档目录结构识别（`docs/{feature-slug}/`）
- 或基于分支命名规则识别

### 5.4 合并功能 (spec merge)

**命令格式**：
```bash
spec merge <feature-slug>
```

**功能描述**：
将指定的 feature 分支合并到配置的目标分支。

**处理流程**：
1. 验证 feature 是否存在
2. 切换到目标分支
3. 拉取最新代码
4. 合并 feature 分支
5. 推送合并结果（如果需要）

**行为要求**：
- 不自动删除 feature 分支
- 合并方式可配置（merge/squash/rebase）
- 提供清晰的合并状态反馈

**异常处理**：
- 存在冲突时，提示用户手动解决
- 目标分支不存在时，提示错误
- 工作区有未提交变更时，提示用户先提交

## 6. 非功能需求

### 6.1 易用性

- 命令简洁明了
- 提供清晰的提示和错误信息
- 交互式向导友好易懂

### 6.2 可配置性

- 支持配置文件，适应不同项目规范
- 配置项可扩展
- 提供合理的默认值

### 6.3 集成性

- 依赖本地 Git 命令，无需额外安装
- 支持主流 LLM 服务（通过环境变量配置）
- 兼容常见的项目结构和测试框架

### 6.4 可靠性

- 操作失败时不破坏现有项目结构
- 提供清晰的错误信息和恢复建议
- 验证用户输入和配置有效性

### 6.5 可扩展性

- 架构设计支持未来添加新命令
- 支持自定义文档模板
- 预留团队协作功能的扩展空间

## 7. MVP 范围

**MVP 版本包含的命令**：
- `spec init` - 初始化配置
- `spec create <description>` - 创建 feature
- `spec list` - 列出 features
- `spec merge <slug>` - 合并 feature

**MVP 版本不包含**：
- `spec delete` - 删除 feature（未来版本）
- `spec status` - 查看 feature 状态（未来版本）
- 团队协作功能
- 文档模板管理
- 高级 Git 工作流支持

## 8. 外部依赖

### 8.1 LLM API

**用途**：根据用户描述生成规范的 feature-slug

**配置方式**：通过环境变量配置 API Key 和 Provider

**说明要求**：在工具文档中提供详细的配置说明

### 8.2 Git

**要求**：
- 本地已安装 Git 命令
- 在 Git 仓库中运行
- 用户已配置 Git 基本信息（user.name, user.email）

## 9. 约束和限制

- 工具需要在 Git 仓库根目录或子目录中运行
- 需要网络连接（调用 LLM API）
- 遵循项目现有的目录结构和命名规范
- 不修改现有的文件内容，仅创建新文件和分支

## 10. 未来规划

- 支持删除和归档 feature
- Feature 状态跟踪和进度管理
- 自定义文档模板管理
- 团队协作功能（如多人协作的 feature）
- 支持更多 Git 工作流
- 与 CI/CD 集成
- 生成 feature 报告和统计
